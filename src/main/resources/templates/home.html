<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>Ìôà</title>
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/home.css"/>
</head>
<body>
<div th:replace="~{ header.html::header}"></div>

<main>
    <div th:replace="~{ sidebar.html::sidebar}"></div>

    <div class="container">
        <div id="error-message" th:text="${error}" style="display:none;"></div>

        <!--        <div class="header-content">-->
        <!--            <div class="header-left">-->
        <!--                <h1 th:text="${userName} + ' Îãò'">ÏãúÏõê Îãò</h1>-->
        <!--                <p th:text="${today}">2024ÎÖÑ 11Ïõî 26Ïùº ÏàòÏöîÏùº</p>-->
        <!--            </div>-->
        <!--            <div class="header-right">-->
        <!--                <div class="current-time" id="currentTime">09:23:45</div>-->
        <!--            </div>-->
        <!--        </div>-->

        <!-- ÎåÄÏãúÎ≥¥Îìú -->
        <div class="dashboard-grid">

            <!--             ÏÇ¨Ïõê Ï†ïÎ≥¥-->
            <div class="card employee-info-card">
                <div class="card-header">
                    <div>

                        <div class="card-title">ÏÇ¨Ïõê Ï†ïÎ≥¥</div>
                        <div class="card-subtitle">Employee Information</div>
                        <!--                        <div class="card-header-right" style="position: relative;">-->
                        <!--                            <div class="card-empinfo" style="position: absolute; right: 0;">ÏùºÎ∞òÏÇ¨Ïõê/Î¶¨Îçî/Í¥ÄÎ¶¨Ïûê</div>-->
                        <!--                        </div>-->
                    </div>
                </div>

                <div class="employee-info-table">
                    <div class="row">
                        <div class="label">ÏÇ¨Î≤à</div>
                        <div class="value" th:text="${empInfo.empCode}">EMP001</div>
                    </div>
                    <div class="row">
                        <div class="label">Ïù¥Î¶Ñ</div>
                        <div class="value" th:text="${empInfo.empName}">ÌôçÍ∏∏Îèô</div>
                    </div>
                    <div class="row">
                        <div class="label">Î∂ÄÏÑú</div>
                        <div class="value" th:text="${empInfo.deptName}">Í∞úÎ∞úÌåÄ</div>
                    </div>
                    <div class="row">
                        <div class="label">Í∑ºÎ¨¥ Ìå®ÌÑ¥</div>
                        <div class="value" th:text="${empInfo.workPatternCode}">WP01</div>
                    </div>
                    <div class="row">
                        <div class="label">ÏßÅÍ∏â</div>
                        <div class="value" th:text="${empInfo.positionName}">ÎåÄÎ¶¨</div>
                    </div>
                    <div class="row">
                        <div class="label">ÏßÅÏúÑ</div>
                        <div class="value" th:text="${empInfo.dutyName}">ÌåÄÏõê</div>
                    </div>
                    <div class="row">
                        <div class="label">Í∑ºÎ¨¥ ÏÉÅÌÉú</div>
                        <div class="value status-value"
                             th:classappend="${empInfo.status == 'WORK'} ? 'status-work' :
                         (${empInfo.status == 'OFF'} ? 'status-off' : 'status-leave')"
                             th:text="${empInfo.status == 'WORK'} ? 'üü¢ Ïû¨ÏßÅ' :
                  (${empInfo.status == 'OFF'} ? 'üî¥ Ìú¥ÏßÅ' : 'üü° Í¥ÄÎ¶¨Ïûê')">
                            Í∑ºÎ¨¥Ï§ë
                        </div>
                    </div>

                </div>
            </div>

            <!-- Ï∂úÌá¥Í∑º Í¥ÄÎ¶¨ -->
            <div class="card attendance-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ï∂úÌá¥Í∑º Í¥ÄÎ¶¨</div>
                        <div class="card-subtitle">Attendance</div>
                    </div>
                </div>


                <div class="time-display">
                    <div class="status-item">
                        <div class="status-label">Í∑ºÎ¨¥ÏãúÍ∞Ñ</div>
                        <div class="status-value" th:text="${workHours}">--:--</div>
                    </div>
                </div>
                <div class="attendance-status">
                    <div class="status-item">
                        <div class="status-label">Ï∂úÍ∑ºÏãúÍ∞Ñ</div>
                        <span th:text="${commuteDto != null and commuteDto.workOnTime != null} ?
               ${#temporals.format(commuteDto.workOnTime, 'HH:mm:ss')} :
               'Ï∂úÍ∑º Ï†ïÎ≥¥ ÏóÜÏùå'"></span>

                    </div>
                    <div class="status-item">
                        <div class="status-label">Ìá¥Í∑ºÏãúÍ∞Ñ</div>
                        <span th:text="${commuteDto != null and commuteDto.workOffTime != null} ?
               ${#temporals.format(commuteDto.workOffTime, 'HH:mm:ss')} :
               'Ìá¥Í∑º Ï†ïÎ≥¥ ÏóÜÏùå'"></span>

                    </div>
                </div>


                <!-- Ï∂úÌá¥Í∑º Í∏∞Î°ù -->
                <div class="attendance-buttons">
                    <form th:action="@{/commute/on}" method="post" style="display:inline;">
                        <button class="btn btn-primary" type="submit">Ï∂úÍ∑º</button>
                    </form>
                    <form th:action="@{/commute/off}" method="post" style="display:inline;">
                        <button class="btn btn-success" type="submit">Ìá¥Í∑º</button>
                    </form>
                </div>
            </div>

            <!--Ïù¥Î≤àÏ£º Í∑ºÎ¨¥ ÌòÑÌô©-->
            <div class="card weekly-work-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ïù¥Î≤àÏ£º Í∑ºÎ¨¥ ÌòÑÌô©</div>
                        <div class="card-subtitle">Weekly Work Hours</div>
                    </div>
                </div>

                <div class="bar-chart">
                    <!-- JSÍ∞Ä Ïó¨Í∏∞ ÏïàÏóê bar-item Ï∂îÍ∞Ä -->
                </div>
            </div>

            <!-- Ïó∞Ï∞® ÌòÑÌô© Ïπ¥Îìú -->
            <div class="card annual-leave-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ïó∞Ï∞® ÌòÑÌô©</div>
                        <div class="card-subtitle">Annual Leave Status</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>ÏÇ¨Ïö©Î•†</span>
                        <span><strong
                                th:text="${annualLeaveDto.useDay != null} ? (${annualLeaveDto.useDay} * 100 / 20) : 0"></strong>%
                        </span>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill"
                             th:style="'width: ' + (${annualLeaveDto.useDay} * 100 / 20) + '%'">
                        </div>
                    </div>
                </div>

                <div class="leave-stats">
                    <div class="leave-stat">
                        <div class="leave-stat-value">
                            20
                        </div>
                        <div class="leave-stat-label">Ï¥ù Ïó∞Ï∞®</div>
                    </div>

                    <div class="leave-stat">
                        <div class="leave-stat-value"
                             th:text="${annualLeaveDto.useDay != null} ? ${annualLeaveDto.useDay} : '6'">
                            6
                        </div>
                        <div class="leave-stat-label">ÏÇ¨Ïö©</div>
                    </div>

                    <div class="leave-stat">
                        <div class="leave-stat-value"
                             th:text="${annualLeaveDto.balanceDay != null} ? ${annualLeaveDto.balanceDay} : '9'">
                            9
                        </div>
                        <div class="leave-stat-label">ÏûîÏó¨</div>
                    </div>

                    <div class="leave-stat">
                        <div class="leave-stat-value"
                             th:text="${annualLeaveDto.expectedDay != null} ? ${annualLeaveDto.expectedDay} : '2'">
                            2
                        </div>
                        <div class="leave-stat-label">ÏòàÏ†ï</div>
                    </div>
                </div>
            </div>

            <!-- Ïò§ÎäòÏùò ÏïåÎ¶º -->
            <!--            <div class="card task-card">-->
            <!--                <div class="card-header">-->
            <!--                    <div>-->
            <!--                        <div class="card-title">Ïò§ÎäòÏùò ÏïåÎ¶º</div>-->
            <!--                        <div class="card-subtitle">Today's Tasks</div>-->
            <!--                    </div>-->
            <!--                </div>-->

            <!--                <div class="task-stats">-->
            <!--                    <div class="task-stat">-->
            <!--                        <div class="task-stat-circle total">-->
            <!--                            <span th:text="${taskStats != null} ? ${taskStats.total} : '9'">9</span>-->
            <!--                        </div>-->
            <!--                        <div class="task-stat-info">-->
            <!--                            <span class="task-stat-value"-->
            <!--                                  th:text="${taskStats != null} ? ${taskStats.total} : '9'">9</span>-->
            <!--                            <span class="task-stat-label">Ï†ÑÏ≤¥ ÏóÖÎ¨¥</span>-->
            <!--                        </div>-->
            <!--                    </div>-->

            <!--                    <div class="task-stat">-->
            <!--                        <div class="task-stat-circle completed">-->
            <!--                            <span th:text="${taskStats != null} ? ${taskStats.completed} : '4'">4</span>-->
            <!--                        </div>-->
            <!--                        <div class="task-stat-info">-->
            <!--                            <span class="task-stat-value" th:text="${taskStats != null} ? ${taskStats.completed} : '4'">4</span>-->
            <!--                            <span class="task-stat-label">ÏôÑÎ£å</span>-->
            <!--                        </div>-->
            <!--                    </div>-->

            <!--                    <div class="task-stat">-->
            <!--                        <div class="task-stat-circle pending">-->
            <!--                            <span th:text="${taskStats != null} ? ${taskStats.pending} : '5'">5</span>-->
            <!--                        </div>-->
            <!--                        <div class="task-stat-info">-->
            <!--                            <span class="task-stat-value"-->
            <!--                                  th:text="${taskStats != null} ? ${taskStats.pending} : '5'">5</span>-->
            <!--                            <span class="task-stat-label">ÏßÑÌñâÏ§ë</span>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->

            <!--                <div class="task-list">-->
            <!--                    <div class="task-item"-->
            <!--                         th:each="task : ${tasks}"-->
            <!--                         th:classappend="'priority-' + ${task.priority}">-->
            <!--                        <div class="task-checkbox" onclick="toggleTask(this)"></div>-->

            <!--                        <div class="task-content">-->
            <!--                            <div class="task-title" th:text="${task.title}">API Î¨∏ÏÑú ÏûëÏÑ±</div>-->
            <!--                            <div class="task-meta">-->
            <!--                                <span class="task-time">‚è∞ <span th:text="${task.dueTime}">14:00</span></span>-->
            <!--                                <span th:text="${task.category}">Í∞úÎ∞ú</span>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->

            <!--            </div> &lt;!&ndash; task-card end &ndash;&gt;-->

            <!-- Ïò§ÎäòÏùò Ìï†Ïùº -->
            <div class="card today-task-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ïò§ÎäòÏùò Ìï†Ïùº</div>
                        <div class="card-subtitle">Today's Tasks</div>
                    </div>
                </div>

                <div class="card-body">

                    <!-- ÏùºÎ∞òÏÇ¨Ïõê (ROLE_USER) -->
                    <div class="todo-section" sec:authorize="hasRole('USER')">
                        <div class="todo-info">
                            <div class="todo-item">
                                <div class="todo-item-title">Í∏àÏùº Í∑ºÌÉú Ïã†Ï≤≠ ÎÇ¥Ïó≠</div>
                                <div class="todo-item-content">
                                    ÏùºÎ∞ò Í∑ºÌÉú <strong th:text="${user.generalCount}">0</strong>Í±¥
                                </div>
                                <div class="todo-item-content">
                                    Í∏∞ÌÉÄ Í∑ºÌÉú <strong th:text="${user.etcCount}">0</strong>Í±¥
                                </div>
                            </div>
                            <div class="todo-item">
                                <div class="todo-item-title">Í∏àÏùº Í≤∞Ïû¨Îêú Ïã†Ï≤≠ÏÑú</div>
                                <div class="todo-item-content">
                                    ÏäπÏù∏ <strong th:text="${user.approvedCount}">0</strong>Í±¥
                                </div>
                                <div class="todo-item-content">
                                    Î∞òÎ†§ <strong th:text="${user.rejectedCount}">0</strong>Í±¥
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Î¶¨Îçî (ROLE_LEADER) -->
                    <div class="todo-section" sec:authorize="hasRole('LEADER')">
                        <div class="todo-info">
                            <div class="todo-item">
                                <div class="todo-item-title">Í∏àÏùº Í∑ºÌÉú Ïã†Ï≤≠ ÎÇ¥Ïó≠</div>
                                <div class="todo-item-content">
                                    ÏùºÎ∞ò Í∑ºÌÉú <strong th:text="${leader.generalCount}">0</strong>Í±¥
                                </div>
                                <div class="todo-item-content">
                                    Í∏∞ÌÉÄ Í∑ºÌÉú <strong th:text="${leader.etcCount}">0</strong>Í±¥
                                </div>
                            </div>
                            <div class="todo-item">
                                <div class="todo-item-title">Ï≤òÎ¶¨Ìï† Î¨∏ÏÑú</div>
                                <div class="todo-item-content">
                                    Í≤∞Ïû¨ ÎåÄÍ∏∞ <strong th:text="${leader.pendingApprovalCount}">0</strong>Í±¥
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Í¥ÄÎ¶¨Ïûê (ROLE_ADMIN) -->
                    <div class="todo-section" sec:authorize="hasRole('ADMIN')">
                        <div class="todo-info admin-todo-info">
                            <div class="todo-item">
                                <div class="todo-item-title">Î∂ÄÏÑú ÎØ∏Î∞∞Ï†ï ÏÇ¨Ïõê</div>
                                <div class="todo-item-content">
                                    <strong th:text="${admin.noDeptEmployeeCount}">0</strong>Î™Ö
                                </div>
                            </div>
                            <div class="todo-item">
                                <div class="todo-item-title">Í∑ºÌÉúÌå®ÌÑ¥ ÎØ∏ÏßÄÏ†ï ÏÇ¨Ïõê</div>
                                <div class="todo-item-content">
                                    <strong th:text="${admin.noPatternEmployeeCount}">0</strong>Î™Ö
                                </div>
                            </div>
                            <div class="todo-item">
                                <div class="todo-item-title">Î¶¨Îçî ÎØ∏Î∞∞Ï†ï Î∂ÄÏÑú</div>
                                <div class="todo-item-content">
                                    <strong th:text="${admin.noLeaderDeptCount}">0</strong>Í∞ú
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>


        </div> <!-- dashboard-grid end -->

    </div> <!-- container end -->

</main>
<script th:inline="javascript">
    /*<![CDATA[*/
    const errorMsg = /*[[${message}]]*/ null;
    if (errorMsg != null) {
        alert(errorMsg);
    }
    /*]]>*/
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const weeklyWorkedHours = /*[[${weeklyWorkedHours}]]*/ [8.5, 9.0, 8.0, 0, 0, 0, 0];

    const weekdays = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];

    const today = new Date();
    const todayIndex = today.getDay() === 0 ? 6 : today.getDay() - 1;

    const chartContainer = document.querySelector('.bar-chart');

    weeklyWorkedHours.forEach((hour, i) => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';

        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = (hour * 15) + 'px';
        bar.dataset.day = weekdays[i];
        bar.dataset.hours = hour;

        if (i === todayIndex) {
            bar.classList.add('today-bar');
        }
        
        // Ï£ºÎßê(ÌÜ†, Ïùº) Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä
        if (i === 5 || i === 6) {
            bar.classList.add('weekend-bar');
        }

        const barValue = document.createElement('span');
        barValue.className = 'bar-value';
        barValue.textContent = hour + 'h';
        bar.appendChild(barValue);

        if (i === todayIndex) {
            barValue.classList.add('today-value'); // ‚Üê Ïöî Î∂ÄÎ∂Ñ!
        }
        
        // Ï£ºÎßê Í∞í Ïä§ÌÉÄÏùº
        if (i === 5 || i === 6) {
            barValue.classList.add('weekend-value');
        }

        const barLabel = document.createElement('div');
        barLabel.className = 'bar-label';
        barLabel.textContent = weekdays[i];
        if (i === todayIndex) barLabel.classList.add('today');
        
        // Ï£ºÎßê ÎùºÎ≤® Ïä§ÌÉÄÏùº
        if (i === 5 || i === 6) {
            barLabel.classList.add('weekend');
        }

        barItem.appendChild(bar);
        barItem.appendChild(barLabel);

        chartContainer.appendChild(barItem);
    });
    /*]]>*/
</script>

<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/home.js}"></script>
</body>
</html>
