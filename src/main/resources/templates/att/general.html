<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>일반근태 신청</title>
    <link rel="stylesheet" th:href="@{/css/att.css}" />
</head>

<body>

<h2>일반근태 신청</h2>

<form th:action="@{/att/search}" method="get" class="search-box">
    <div class="row">
        <label for="attType">근무유형</label>
        <select id="attType" name="attType">
            <option value="OT">연장근로</option>
            <option value="HOLIDAY">휴일근로</option>
            <option value="EARLY">조퇴</option>
            <option value="GOOUT">외출</option>
            <option value="HALF">반차</option>
        </select>

        <label for="workDate">근무일</label>
        <input id="workDate" name="workDate" type="date" />

        <label for="empCode">사번</label>
        <input type="text" id="empCode" name="empCode"
               th:value="${role == 'USER' ? empCode : ''}"
               th:readonly="${role == 'USER'}"
               placeholder="사번 입력" />

        <label for="deptName">부서</label>
        <input type="text" id="deptName" name="deptName"
               th:value="${deptName}"
               readonly
               th:readonly="${role == 'USER' or role == 'LEADER'}"
               placeholder="부서명" />

        <button type="submit">조회</button>

        <span class="note">※ 근무일 선택 후 ‘조회’ 클릭</span>
    </div>
</form>

<div class="btn-area">
    <button class="btn btn-save">저장</button>
    <button class="btn btn-delete">삭제</button>
    <button class="btn btn-request">상신</button>
    <button class="btn btn-cancel">상신 취소</button>
</div>

<div class="table-container">
    <table th:if="${empList != null and #lists.size(empList) > 0}">
        <thead>
        <tr>
            <th><input type="checkbox" id="checkAll" /></th>
            <th>사번</th>
            <th>성명</th>
            <th>직위</th>
            <th>부서</th>
            <th>계획</th>
            <th>실적</th>
            <th>구분</th>
            <th>사유</th>
            <th>사유내용</th>
            <th>시작시간</th>
            <th>종료시간</th>
            <th class="highlight">예상근로시간</th>
            <th>상태</th>
            <th>신청자</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="work : ${empList}">
            <td><input type="checkbox" class="rowCheck" th:value="${work.id}" /></td>
            <td th:text="${work.empNo}"></td>
            <td th:text="${work.name}"></td>
            <td th:text="${work.position}"></td>
            <td th:text="${work.department}"></td>
            <td th:text="${work.plan}"></td>
            <td th:text="${work.result}"></td>
            <td th:text="${work.type}"></td>
            <td th:text="${work.reason}"></td>
            <td th:text="${work.reasonDetail}"></td>
            <td th:text="${work.startTime}"></td>
            <td th:text="${work.endTime}"></td>
            <td th:text="${work.expectedHours}" class="highlight"></td>
            <td th:text="${work.status}"></td>
            <td th:text="${work.applicant}"></td>
        </tr>
        </tbody>
    </table>

    <div th:if="${empList == null or #lists.isEmpty(empList)}"
         style="text-align:center; color:#888; margin-top:10px;">
        조회된 데이터가 없습니다.
    </div>

    <div class="note important">
        🔹 상신 후 신청 시간 적용됩니다.
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // 오늘 날짜 자동 입력
        const dateInput = document.getElementById("workDate");
        if (dateInput) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${year}-${month}-${day}`;
        }

        // 전체 선택/해제 기능
        const checkAll = document.getElementById('checkAll');
        const rowChecks = document.querySelectorAll('.rowCheck');

        if (checkAll) {
            checkAll.addEventListener('change', () => {
                rowChecks.forEach(cb => cb.checked = checkAll.checked);
            });

            rowChecks.forEach(cb => {
                cb.addEventListener('change', () => {
                    checkAll.checked = Array.from(rowChecks).every(c => c.checked);
                });
            });
        }
    });
</script>

</body>
</html>
