<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>일반근태 신청</title>
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/att.css" />
</head>
<body>

<div th:replace="~{header.html::header}"></div>
<main>
    <div th:replace="~{sidebar.html::sidebar}"></div>
    <div class="container">
        <div class="header">
            <h1>일반 근태 신청</h1>
        </div>

        <!-- 🔍 조회 폼 -->
        <form id="searchForm" class="search-box" action="/att/search" method="get">
            <label>근무유형
                <select name="attType">
                    <option value="연장" th:selected="${attType == '연장'}">연장근로</option>
                    <option value="조출" th:selected="${attType == '조출'}">연장(조출)근로</option>
                    <option value="휴일" th:selected="${attType == '휴일'}">휴일근로</option>
                    <option value="조퇴" th:selected="${attType == '조퇴'}">조퇴</option>
                    <option value="외출" th:selected="${attType == '외출'}">외출</option>
                    <option value="반차" th:selected="${attType == '반차'}">반차</option>
                </select>
            </label>

            <label>근무일
                <input type="date" name="workDate" id="workDate"
                       th:value="${workDate != null} ? ${workDate} : ${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
            </label>

            <label for="empCode">사번</label>
            <input type="text" id="empCode" name="empCode"
                   th:value="${role == 'USER'} ? ${empCode} : ''"
                   th:readonly="${role == 'USER'}"
                   placeholder="사번 입력" />

            <label for="deptName">부서</label>
            <input type="text" id="deptName" name="deptName"
                   th:value="${deptName}" readonly placeholder="부서명" />

            <button type="button" id="btnSearch">조회</button>
            <span class="note">※ 근무일 선택 후 '조회' 클릭</span>
        </form>

        <div class="btn-area">
            <button class="btn btn-save" id="btnSave">저장</button>
            <button class="btn btn-delete" id="btnDelete">삭제</button>
            <button class="btn btn-request" id="btnRequest">상신</button>
            <button class="btn btn-cancel" id="btnRequestCancel">상신 취소</button>
        </div>

        <table id="attTable">
            <thead>
            <tr>
                <th><input type="checkbox" id="checkAll"></th>
                <th>사번</th>
                <th>성명</th>
                <th>직위</th>
                <th>부서</th>
                <th>계획</th>
                <th>실적</th>
                <th>구분</th>
                <th>사유</th>
                <th>사유내용</th>
                <th>시작시간</th>
                <th>종료시간</th>
                <th class="highlight">예상근로시간</th>
                <th>상태</th>
                <th>신청자</th>
            </tr>
            </thead>
            <tbody id="tableBody">
            <tr th:each="emp : ${empList}">
                <td><input type="checkbox" class="rowCheck" th:value="${emp.empNo}"></td>
                <td class="empNo" th:text="${emp.empNo}"></td>
                <td class="name" th:text="${emp.name}"></td>
                <td class="position" th:text="${emp.position}"></td>
                <td class="department" th:text="${emp.department}"></td>
                <td class="plan" th:text="${emp.plan}"></td>
                <td class="result" th:text="${emp.realWorkRecord}"></td>
                <td class="workType" th:text="${emp.workType}"></td>
                <td>
                    <select class="reason">
                        <option value="">--선택--</option>
                        <option value="업무지연" th:selected="${emp.reqReason == '업무지연'}">업무지연</option>
                        <option value="프로젝트마감" th:selected="${emp.reqReason == '프로젝트마감'}">프로젝트 마감</option>
                        <option value="고객요청" th:selected="${emp.reqReason == '고객요청'}">고객 요청</option>
                        <option value="기타" th:selected="${emp.reqReason == '기타'}">기타</option>
                    </select>
                </td>
                <td><input type="text" class="reasonDetail" th:value="${emp.reqReasonDetail}"></td>
                <td><input type="time" class="startTime" th:value="${emp.startTime}"></td>
                <td><input type="time" class="endTime" th:value="${emp.endTime}"></td>
                <td class="expectedHours highlight"></td>
                <td class="status" th:switch="${emp.reqStatus}">
                    <span th:case="'SAVED'">저장</span>
                    <span th:case="'SUBMITTED'">상신</span>
                    <span th:case="'APPROVED'">승인</span>
                    <span th:case="'REJECTED'">반려</span>
                    <span th:case="*"></span>
                </td>
                <td class="applicant" th:text="${emp.applicant}"></td>
            </tr>

            <tr th:if="${#lists.isEmpty(empList)}">
                <td colspan="15" style="text-align:center;">조회된 데이터가 없습니다.</td>
            </tr>
            </tbody>
        </table>
    </div>
</main>
<script th:inline="javascript">
    /*<![CDATA[*/
    const errorMsg = /*[[${error}]]*/ null;
    if (errorMsg != null) {
        alert(errorMsg);
    }
    /*]]>*/
</script>
<script th:src="@{/js/form.js}"></script>

<script>


    document.addEventListener('DOMContentLoaded', () => {
        // 오늘 날짜 자동 입력
        const dateInput = document.getElementById("workDate");
        // const today = new Date();
        // dateInput.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

        // 전체 체크박스 초기화
        initCheckAll('#checkAll', '.rowCheck');

        // 조회 버튼 (form GET)
        document.getElementById('btnSearch').addEventListener('click', () => {
            submitSearch('#searchForm');
        });

        // 저장 버튼 (POST /att/save)
        document.getElementById('btnSave').addEventListener('click', () => {
            const workDate = document.querySelector('#workDate').value;
            submitSave('/att/save', workDate);
        });

        // 삭제 버튼 (POST /att/delete)
        document.getElementById('btnDelete').addEventListener('click', () => {
            const workDate = document.querySelector('#workDate').value;
            submitDelete('/att/delete', workDate);
        });
    });
</script>

</body>
</html>
