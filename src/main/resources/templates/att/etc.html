<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê¸°íƒ€ê·¼íƒœì‹ ì²­</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/att.css}">
</head>
<body>

<div th:replace="~{header.html::header}"></div>

<main>
    <div th:replace="~{sidebar.html::sidebar}"></div>

    <section class="container">

        <div class="header">
            <h1>ê¸°íƒ€ ê·¼íƒœ ì‹ ì²­</h1>
        </div>

        <!-- ğŸ”· 1. ì¡°íšŒ ì¡°ê±´ -->
        <form id="searchForm" th:action="@{/etc/search}" method="get" class="search-box">

            <label class="required">ê·¼ë¬´ì¼
                <input type="date" name="workDate" id="workDate" required>
            </label>

            <label>ì‚¬ë²ˆ
                <input type="text" name="empCode" id="empCode" placeholder="ì‚¬ë²ˆ ì…ë ¥">
            </label>

            <label>ê·¼ë¬´ê³„íš
                <select name="planType" id="planType">
                    <option value="">ì „ì²´</option>
                    <option value="ì£¼ê°„">ì£¼ê°„</option>
                    <option value="ì•¼ê°„">ì•¼ê°„</option>
                </select>
            </label>

            <label class="required">ë¶€ì„œ
                <select name="dept" id="dept" required>
                    <option value="">ë‚´ ë¶€ì„œ</option>
                    <option value="ì¸ì‚¬íŒ€">ì¸ì‚¬íŒ€</option>
                    <option value="ì´ë¬´íŒ€">ì´ë¬´íŒ€</option>
                </select>
            </label>

            <button type="submit" class="btn btn-request" id="btnSearch">ì¡°íšŒ</button>
            <span class="note">â€» ê·¼ë¬´ì¼ ì„ íƒ í›„ 'ì¡°íšŒ' í´ë¦­</span>
        </form>

        <!-- ğŸ”· 2. í•„ìˆ˜ ì…ë ¥í•­ëª© -->
        <form id="applyForm" th:action="@{/etc/apply}" method="post" class="search-box">

            <label class="required">ë³€ê²½ê·¼ë¬´
                <select name="changeType" id="changeType" required>
                    <option value="">ì„ íƒ</option>
                    <option value="ì—°ì¥ê·¼ë¬´">ì—°ì¥ê·¼ë¬´</option>
                    <option value="ì¡°ê¸°ì¶œê·¼">ì¡°ê¸°ì¶œê·¼</option>
                    <option value="íŠ¹ê·¼">íŠ¹ê·¼</option>
                </select>
            </label>

            <label class="required">ê¸°ê°„
                <input type="date" name="startDate" id="startDate" required> ~
                <input type="date" name="endDate" id="endDate" required>
            </label>

            <label class="required">ì‚¬ìœ 
                <input type="text" name="reason" id="reason" placeholder="ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            </label>

            <label class="required">ì‹ ì²­ì‹œê°
                <select name="applyTime" id="applyTime" required>
                    <option value="">ì„ íƒ</option>
                    <option value="ì˜¤ì „">ì˜¤ì „</option>
                    <option value="ì˜¤í›„">ì˜¤í›„</option>
                </select>
            </label>

            <button type="submit" class="btn btn-save">ì ìš©</button>
        </form>

        <!-- ğŸ”· 3. ë²„íŠ¼ ì˜ì—­ -->
        <div class="btn-area">
            <button class="btn btn-save" id="btnSave">ì €ì¥</button>
            <button class="btn btn-delete" id="btnDelete">ì‚­ì œ</button>
            <button class="btn btn-request" id="btnRequest">ìƒì‹ </button>
            <button class="btn btn-cancel" id="btnRequestCancel">ìƒì‹  ì·¨ì†Œ</button>
        </div>

        <!-- ğŸ”· 4. ì¡°íšŒ ê²°ê³¼ ëª©ë¡ -->
        <table id="attTable">
            <thead>
            <tr>
                <th>ì‚¬ë²ˆ</th>
                <th>ì„±ëª…</th>
                <th>ì§ìœ„</th>
                <th>ë¶€ì„œ</th>
                <th>ì‹¤ì </th>
                <th>ë³€ê²½ê·¼ë¬´</th>
                <th>ì‹œì‘ì¼</th>
                <th>ì¢…ë£Œì¼</th>
                <th>ì—°ì°¨ì”ì—¬</th>
                <th>ì‚¬ìœ </th>
                <th>ì‹ ì²­ì‹œê°</th>
                <th>ìƒíƒœ</th>
                <th>ì‹ ì²­ì</th>
            </tr>

            </thead>

            <tbody>
            <tr th:each="emp : ${empList}">

                <td th:text="${emp.empCode}"></td>
                <td th:text="${emp.empName}"></td>
                <td th:text="${emp.position}"></td>
                <td th:text="${emp.dept}"></td>
                <td th:text="${emp.realWorkRecord}"></td>

                <!-- ğŸ”¹ ë³€ê²½ê·¼ë¬´ (í•„ìˆ˜) -->
                <td>
                    <select class="changeType" required>
                        <option value="">ì„ íƒ</option>
                        <option value="ì—°ì¥ê·¼ë¬´" th:selected="${emp.changeType == 'ì—°ì¥ê·¼ë¬´'}">ì—°ì¥ê·¼ë¬´</option>
                        <option value="ì¡°ê¸°ì¶œê·¼" th:selected="${emp.changeType == 'ì¡°ê¸°ì¶œê·¼'}">ì¡°ê¸°ì¶œê·¼</option>
                        <option value="íŠ¹ê·¼"     th:selected="${emp.changeType == 'íŠ¹ê·¼'}">íŠ¹ê·¼</option>
                    </select>
                </td>

                <!-- ğŸ”¹ ì‹œì‘ì¼ (í•„ìˆ˜) -->
                <td>
                    <input type="date" class="startDate" th:value="${emp.startDate}" required>
                </td>

                <!-- ğŸ”¹ ì¢…ë£Œì¼ (í•„ìˆ˜) -->
                <td>
                    <input type="date" class="endDate" th:value="${emp.endDate}" required>
                </td>

                <td th:text="${emp.restAnnual}"></td>

                <!-- ğŸ”¹ ì‚¬ìœ  (í•„ìˆ˜) -->
                <td>
                    <input type="text" class="reason" th:value="${emp.reason}" required>
                </td>

                <!-- ğŸ”¹ ì‹ ì²­ì‹œê° (í•„ìˆ˜) -->
                <td>
                    <select class="applyTime" required>
                        <option value="">ì„ íƒ</option>
                        <option value="ì˜¤ì „" th:selected="${emp.applyTime == 'ì˜¤ì „'}">ì˜¤ì „</option>
                        <option value="ì˜¤í›„" th:selected="${emp.applyTime == 'ì˜¤í›„'}">ì˜¤í›„</option>
                    </select>
                </td>

                <td th:text="${emp.status}"></td>
                <td th:text="${emp.applicant}"></td>

            </tr>
            </tbody>

        </table>

    </section>
</main>
<script th:inline="javascript">
    /*<![CDATA[*/
    const errorMsg = /*[[${error}]]*/ null;
    if (errorMsg != null) {
        alert(errorMsg);
    }
    /*]]>*/
</script>
<script th:src="@{/js/form.js}"></script>
<script th:src="@{/js/att.js}"></script>
<script th:src="@{/js/script.js}"></script>
<script>
    document.getElementById("btnSave").addEventListener("click", validateRows);
    document.getElementById("btnRequest").addEventListener("click", validateRows);

    function validateRows(evt) {
        const rows = document.querySelectorAll("#attTable tbody tr");

        for (const row of rows) {
            const changeType = row.querySelector(".changeType").value;
            const startDate  = row.querySelector(".startDate").value;
            const endDate    = row.querySelector(".endDate").value;
            const reason     = row.querySelector(".reason").value;
            const applyTime  = row.querySelector(".applyTime").value;

            if (!changeType || !startDate || !endDate || !reason || !applyTime) {
                alert("í•„ìˆ˜ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
                evt.preventDefault();
                return false;
            }
        }
    }
</script>

</body>
</html>
