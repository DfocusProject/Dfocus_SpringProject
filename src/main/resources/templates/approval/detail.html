<!-- templates/approval/detail.html -->
<div th:fragment="detailFragment">

    <div class="pan-header">
        일근태 신청 상세
        <span style="margin-right: 10px">신청번호: <span th:text="${requestId}"></span></span>
    </div>

    <div class="body">

        <!-- 기본 정보 -->
        <table class="detail-table">
            <tbody>
            <tr>
                <th>신청자</th>
                <td th:text="${empInfo.reqEmpCode + ' / ' + empInfo.reqEmpName}"></td>
                <th>부서명</th>
                <td th:text="${empInfo.department}"></td>
                <th>신청일</th>
                <td th:text="${empInfo.reqDate}"></td>
            </tr>
            <tr>
                <th>대상자</th>
                <td th:text="${empInfo.targetEmpCode + ' / ' + empInfo.targetEmpName}"></td>
                <th>부서명</th>
                <td th:text="${empInfo.department}"></td>
                <th>계획근무</th>
                <td th:text="${empInfo.planType}"></td>
            </tr>
            </tbody>
        </table>

        <!-- 신청 근태 상세 -->
        <div class="panel">
            <div class="title" th:text="'신청근태: ' + (${reqInfo.reqType} ?: '')">
                신청근태: []
            </div>

            <div class="body">
                <!-- 일반 -->
                <table class="detail-table"
                       th:if="${reqInfo.reqType != '반차' and reqInfo.reqType != '조퇴' and reqInfo.reqType != '기타'and reqInfo.reqType != '연차'}">
                    <tr>
                        <th>근무일</th>
                        <td th:text="${reqInfo.startDate}"></td>

                        <th>근무시간</th>
                        <td th:text="(${reqInfo.startNextDay} ? '익일 ' : '당일 ')
                           + ${#strings.substring(reqInfo.startTime,0,5)}
                           + ' ~ '
                           + (${reqInfo.endNextDay} ? '익일 ' : '당일 ')
                           + ${#strings.substring(reqInfo.endTime,0,5)}
                           + '(' + ${reqInfo.hours} + '시간)'"></td>
                    </tr>

                    <tr>
                        <th>사유</th>
                        <td colspan="3" th:text="${reqInfo.reason}"></td>
                    </tr>

                    <tr>
                        <th>사유내용</th>
                        <td colspan="3" th:text="${reqInfo.reasonDetail}"></td>
                    </tr>
                </table>

                <!-- 반차 -->
                <table class="detail-table"
                       th:if="${reqInfo.reqType == '반차'}">
                    <tr>
                        <th>근무일</th>
                        <td th:text="${reqInfo.startDate}"></td>

                        <th>근무시간</th>
                        <td th:text="(${reqInfo.startNextDay} ? '익일 ' : '당일 ')
                           + ${#strings.substring(reqInfo.startTime,0,5)}
                           + ' ~ '
                           + (${reqInfo.endNextDay} ? '익일 ' : '당일 ')
                           + ${#strings.substring(reqInfo.endTime,0,5)}
                           + '(' + ${reqInfo.hours} + '시간)'"></td>
                    </tr>

                    <tr>
                        <th>사유</th>
                        <td th:text="${reqInfo.reason}"></td>

                        <th>반차구분</th>
                        <td th:text="${reqInfo.halfType}"></td>
                    </tr>

                    <tr>
                        <th>사유내용</th>
                        <td colspan="3" th:text="${reqInfo.reasonDetail}"></td>
                    </tr>
                </table>

                <!-- 조퇴 -->
                <table class="detail-table"
                       th:if="${reqInfo.reqType == '조퇴'}">
                    <tr>
                        <th>신청일</th>
                        <td th:text="${reqInfo.startDate}"></td>
                        <th>신청시간</th>
                        <td th:text="${#strings.substring(reqInfo.startTime,0,5)}"></td>
                    </tr>
                    <tr>
                        <th>사유</th>
                        <td th:text="${reqInfo.reason}"></td>
                        <th>사유내용</th>
                        <td th:text="${reqInfo.reasonDetail}"></td>
                    </tr>
                </table>

                <!-- 기타 -->
                <table class="detail-table"
                       th:if="${reqInfo.reqType == '기타' || reqInfo.reqType == '연차'}">
                    <tr>
                        <th>대상기간</th>
                        <td th:text="${reqInfo.startDate + ' ~ ' + reqInfo.endDate}"></td>

                        <th>신청시각</th>
                        <td th:text="${reqInfo.isTodayRequest != null ? (reqInfo.isTodayRequest ? '당일신청' : '1일이전신청') : '-'}"></td>
                    </tr>
                    <tr>
                        <th>변경근태</th>
                        <td th:text="${reqInfo.reqDetailType}"></td>

                        <th>사유</th>
                        <td th:text="${reqInfo.reason}"></td>
                    </tr>
                </table>

            </div>
        </div>

        <!-- 근태기 정보 -->
        <div class="panel">
            <div class="title">근태기 정보</div>
            <table class="detail-table commute-table">
            <thead>
                <tr>
                    <th>날짜</th>
                    <th>출근시간</th>
                    <th>퇴근시간</th>
                </tr>
                </thead>
                <tr>
                    <td colspan="1" th:text="${commuteInfo != null && commuteInfo.workDate != null ? commuteInfo.workDate : '-'}"></td>
                    <td colspan="1" th:text="${commuteInfo != null && commuteInfo.workOnTime != null ? #temporals.format(commuteInfo.workOnTime, 'HH:mm:ss') : '-'}"></td>
                    <td colspan="1" th:text="${commuteInfo != null && commuteInfo.workOffTime != null ? #temporals.format(commuteInfo.workOffTime, 'HH:mm:ss') : '-'}"></td>
                </tr>
            </table>
        </div>

        <!-- 결재 정보 -->
        <div class="panel">
            <div class="title">결재 정보</div>
            <!-- 결재 내역 테이블 -->
            <table class="detail-table">
                <thead>
                <tr>
                    <th>순번</th>
                    <th>부서</th>
                    <th>직책</th>
                    <th>이름</th>
                    <th>사번</th>
                    <th>결과</th>
                    <th>결재완료일</th>
                </tr>
                </thead>
                <tbody th:each="approvalInfo : ${approvalInfos}">
                <tr>
                    <td th:text="${approvalInfo.sequenceNo}"></td>
                    <td th:text="${approvalInfo.department}"></td>
                    <td th:text="${approvalInfo.duty}"></td>
                    <td th:text="${approvalInfo.name}"></td>
                    <td th:text="${approvalInfo.empCode}"></td>
                    <td>
                        <span th:switch="${approvalInfo.result}">
                            <span th:case="'PENDING'">승인대기중</span>
                            <span th:case="'APPROVED'">승인</span>
                            <span th:case="'REJECTED'">반려</span>
                            <span th:case="'REQUESTED'">상신완료</span>
                        </span>
                    </td>
                    <td th:text="${approvalInfo.date}"></td>
                </tr>
                </tbody>
            </table>

            <div class="actions">
                <!-- 승인 form -->
                <form th:action="@{/approval/approve}" method="post" style="display:inline-block; margin-right:10px;">
                    <input type="hidden" name="requestIds" th:value="${requestId}">
                    <button type="submit" class="btn approval">승인</button>
                </form>

                <!-- 반려 form -->
                <form th:action="@{/approval/reject}" method="post" style="display:inline-block;">
                    <input type="hidden" name="requestIds" th:value="${requestId}">
                    <label>반려사유</label>
                    <input type="text" name="reason" placeholder="반려 사유 입력" required>
                    <button type="submit" class="btn rejection">반려</button>
                </form>
            </div>

            <div class="jb-division-line"></div>
        </div>

        <!-- 반려사유 (반려된 경우만 표시) -->
        <div class="panel" th:if="${rejectionReason != null and rejectionReason != ''}">
            <div class="title">반려사유</div>
            <div class="body">
                <table class="detail-table">
                    <tr>
                        <th style="width: 150px;">반려사유</th>
                        <td th:text="${rejectionReason}"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
