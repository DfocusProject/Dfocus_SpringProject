<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>부서근태 조회</title>
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/emp_att.css"/>
</head>

<body>
<div th:replace="~{header.html::header}"></div>

<main>
    <div th:replace="~{sidebar.html::sidebar}"></div>

    <div class="container">
        <div class="header">
            <h1>부서근태 조회</h1>
        </div>
        <div class="pann">
            <!-- 검색 박스 -->
            <div class="search-box">
                <form th:action="@{/deptAttSearch/search}" method="get"
                      th:object="${deptAttSearchDto}" class="attform">

                    <label>근무일
                        <input type="date" th:field="*{workDate}">
                    </label>

                    <label>사번
                        <input type="text" th:field="*{empCode}" placeholder="사번 입력"/>
                    </label>

                    <label>근무계획
                        <select name="plan" id="planType">
                            <option value="" th:selected="${planType == ''}">전체</option>
                            <option value="05" th:selected="${planType == '05'}">주간</option>
                            <option value="05-A" th:selected="${planType == '05-A'}">현장실습</option>
                            <option value="06" th:selected="${planType == '06'}">연차</option>
                            <option value="10" th:selected="${planType == '10'}">출장</option>
                            <option value="31" th:selected="${planType == '31'}">4전</option>
                            <option value="32" th:selected="${planType == '32'}">4후</option>
                            <option value="33" th:selected="${planType == '33'}">4야</option>
                            <option value="45" th:selected="${planType == '45'}">3전</option>
                            <option value="46" th:selected="${planType == '46'}">3후</option>
                            <option value="61" th:selected="${planType == '61'}">휴직</option>
                            <option value="64" th:selected="${planType == '64'}">육아휴직</option>
                            <option value="62" th:selected="${planType == '62'}">사외교육</option>
                        </select>
                    </label>

                    <label>부서
                        <select th:field="*{department}">
                            <option value="">전체</option>
                            <option th:each="dept : *{childDeptList}"
                                    th:value="${dept}"
                                    th:text="${dept}">
                            </option>
                        </select>
                    </label>

                    <button type="submit" id="btnSearchDeptAtt" class="btnSearchDeptAtt">조회</button>
                    <div class="right">
                        <button type="button" class="btn approval" id="btnGoGeneral">일반근태 신청</button>
                        <button type="button" class="btn approval" id="btnGoEtc">기타근태 신청</button>
                    </div>
                </form>
            </div>
            <!-- 리스트 테이블 -->
            <div class="attAprlList">
                <form id="attForm" method="get">
                    <input type="hidden" name="empCodes" id="empCodes">
                    <input type="hidden" name="workDate" id="workDateHidden">
                </form>
                <table>
                        <thead>
                        <tr>
                            <th rowspan="2"><input type="checkbox" id="checkAll1"></th>
                            <th rowspan="2">사번</th>
                            <th rowspan="2">성명</th>
                            <th rowspan="2">직위</th>
                            <th rowspan="2">부서</th>
                            <th rowspan="2">계획/실적</th>
                            <th rowspan="2">출근시간</th>
                            <th rowspan="2">퇴근시간</th>
                            <th rowspan="2">휴일근무</th>
                            <th rowspan="2">연장근무</th>
                            <th colspan="3" id="weekRange"
                                th:if="${startDate != null and endDate != null}"
                                th:text="${#temporals.format(startDate,'yyyy-MM-dd') + ' ~ ' + #temporals.format(endDate,'yyyy-MM-dd')}">
                                2025-11-24 ~ 2025-11-30
                            </th>


                        </tr>
                        <tr>
                            <th class="highlight">주근무시간</th>
                            <th>예상근무</th>
                            <th>예상잔여</th>
                        </tr>
                        </thead>

                        <tbody id="tbody">
                        <tr th:each="row : ${results}">
                            <td><input type="checkbox" class="rowCheck"
                                       th:attr="data-empcode=${row.empCode}, data-department=${row.department}">
                            </td>
                            <td th:text="${row.empCode}"></td>
                            <td th:text="${row.empName}"></td>
                            <td th:text="${row.position}"></td>
                            <td th:text="${row.department}"></td>
                            <td th:text="${row.planType != null ? row.planType + ' / ' + row.realType : '계획 없음'}"></td>
                            <td th:text="${#temporals.format(row.workOnTime, 'HH:mm:ss')}"></td>
                            <td th:text="${#temporals.format(row.workOffTime, 'HH:mm:ss')}"></td>
                            <td th:text="${row.holidayTime}"></td>
                            <td th:text="${row.overTime}"></td>
                            <td>52.0</td>
                            <td th:text="${row.expectedTime}"></td>
                            <td th:text="${52 - row.expectedTime}"></td>
                        </tr>
                        </tbody>

                    </table>
            </div>
        </div>
    </div>
</main>

<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/deptAttSearch.js}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchBtn = document.getElementById("btnSearchDeptAtt");
        if (window.location.pathname.includes("/deptAttSearch/main") && searchBtn) {
            searchBtn.click();
        }
    });
</script>
<script th:inline="javascript">
    console.log("results:", /*[[${results}]]*/ []);
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const rows = document.querySelectorAll("#tbody tr");
        console.log("table rows:", rows.length, rows);
    });
</script>

</body>
</html>
