<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>근태패턴별 캘린더</title>
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/pattern.css" />
</head>
<body>
<div th:replace="~{ header.html::header}"></div>

<main>
    <div th:replace="~{ sidebar.html::sidebar}"></div>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <h2>근태패턴별 캘린더</h2>
                <!-- 상단 액션 버튼 -->
                <div class="button-group">
                    <button type="button" id="registerPatternBtn" class="btn">패턴 입력</button>
                    <button type="button" id="savePatternBtn" class="btn">등록</button>
                    <button type="button" id="topActionBtn" class="btn">패턴 추가</button>
                    <button type="button" id="deletePatternBtn" class="btn">패턴 삭제</button>
                </div>
            </div>
            <form th:action="@{/pattern/main}" method="get" id="searchForm">
                <label>조회월:</label>
                <input type="month" name="yearMonth" th:value="${selectedYearMonth}">
                <button type="submit">🔍 조회</button>
            </form>
        </div>
        <div class="main-content">
            <form th:action="@{/pattern/save}" method="post" class="calendar-form" id="patternSaveForm">
                <input type="hidden" name="patternName" id="savePatternName">
                <div class="calendar-container">
                    <table id="patternTable">
                        <thead>
                        <tr>
                            <th class="pattern-header"></th>
                            <th class="pattern-header">근태패턴</th>
                            <th th:each="date : ${dates}" class="date-header"
                                th:classappend="${date.dayOfWeek.value >= 6} ? 'weekend' : ''"
                                th:data-full-date="${date}">
                                <div class="date-header-date" th:text="${#numbers.formatInteger(date.dayOfMonth,2)} + '일'">01일</div>
                                <div class="date-header-day"
                                     th:text="'(' + ${date.dayOfWeek.toString().substring(0,3)} + ')'">(MON)</div>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="patternBody">
                        <tr th:each="pattern, stat : ${patternList}" th:data-pattern-name="${pattern.patternName}">
                            <td><input type="radio" name="selectedPattern" th:value="${pattern.patternName}"></td>
                            <td th:text="${pattern.patternName}">패턴명</td>
                            <td th:each="date : ${dates}"
                                class="code-cell"
                                th:classappend="${pattern.dateCodeMap[date.toString()] != null ? 'code-' + pattern.dateCodeMap[date.toString()] : ''}"
                                th:data-date="${date.toString()}"
                                th:text="${pattern.dateCodeMap[date.toString()]}">코드</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </form>

            <!-- 근태코드 패널 -->
            <div class="code-panel">
                <h3>📋 근태코드 목록</h3>
                <table class="code-table">
                    <thead>
                    <tr>
                        <th>코드</th>
                        <th>근태명</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="shift : ${shiftTypes}">
                        <td th:text="${shift.shiftCode}">00</td>
                        <td th:text="${shift.shiftName}">정상근무</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>
<!-- 패턴 추가 모달 -->
<div class="modal-overlay" id="patternModal">
    <div class="modal-content">
        <div class="modal-header">
            새 패턴 추가
        </div>
        <div class="modal-body">
            <div class="modal-input-group">
                <label for="modalPatternName">패턴명 *</label>
                <input type="text" id="modalPatternName" placeholder="예: 주간, 4전, 육아휴직..." required>
            </div>
            <div class="modal-input-group">
                <label for="modalPatternDesc">패턴 설명</label>
                <input type="text" id="modalPatternDesc" placeholder="패턴에 대한 간단한 설명">
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel" id="modalCancelBtn">취소</button>
            <button type="button" class="modal-btn modal-btn-confirm" id="modalConfirmBtn">추가</button>
        </div>
    </div>
</div>

<!-- 패턴 생성용 숨은 form -->
<form id="createPatternForm" method="post" th:action="@{/pattern/create}">
    <input type="hidden" name="patternName" id="patternNameInput">
    <input type="hidden" name="description" id="patternDescInput">
</form>
<form id="deletePatternForm" method="post" th:action="@{/pattern/delete}">
    <input type="hidden" name="deletePattern" id="deletePatternInput">
</form>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/pattern.js}"></script>
</body>
</html>